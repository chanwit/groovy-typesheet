gunit Typesheet;

@header{package org.codehaus.groovy.typesheet.parser;}

defaultStmt:
    "default: { n ~> int; }"    ->  (DEFAULT_CASE (RETYPE n (PRIMITIVE int)))

retypeDecl:
    "n ~> int;" -> (RETYPE n (PRIMITIVE int))

classPCD:
    "class(int)" -> (CLASS_MATCHER (PRIMITIVE int))
    "class(java.lang.Object+)" -> (CLASS_MATCHER (PATTERN java . lang . Object (PAT_OPTION MATCH_SUBCLASS)))
    "class(java.lang.Object[])" -> (CLASS_MATCHER (PATTERN java . lang . Object (PAT_OPTION ARRAY)))
    "class(java.lang.Object)" -> (CLASS_MATCHER (PATTERN java . lang . Object PAT_OPTION))  

argsPCD:
    "args(a,b,c)" -> (ARGS_PCD a b c)

methodPCD:
    "method(name)" -> (METHOD_PCD name)
    "method(name())" -> (METHOD_PCD name)
    "method(name(int))" -> (METHOD_PCD name (PRIMITIVE int))
    "method(Class#name(int))" -> (METHOD_PCD (PATTERN Class PAT_OPTION) name (PRIMITIVE int))
    "method(name(Object[]+, long, String+))" -> (METHOD_PCD name (PATTERN Object (PAT_OPTION ARRAY MATCH_SUBCLASS)) (PRIMITIVE long) (PATTERN String (PAT_OPTION MATCH_SUBCLASS)))

methodBlock:
<<
method(name) {
    args(a,b,c) { a ~> int; } 
}
>> -> (METHOD_BLOCK (METHOD_PCD name) (ARGS_BLOCK (ARGS_PCD a b c) (RETYPE a (PRIMITIVE int))))
<<
method(static java.Main#name(int, String[])) {
    local(a,b,c) { 
        a,b ~> String;
        c ~> int;        
    }
    args(a,b,c) { a ~> int; } 
}
>> -> (METHOD_BLOCK (METHOD_PCD static (PATTERN java . Main PAT_OPTION) name (PRIMITIVE int) (PATTERN String (PAT_OPTION ARRAY))) (LOCAL_BLOCK (LOCAL_PCD a b c) (RETYPE a b (TYPE String)) (RETYPE c (PRIMITIVE int))) (ARGS_BLOCK (ARGS_PCD a b c) (RETYPE a (PRIMITIVE int))))

/*
    "method(name)" -> (METHOD_PCD name)
    "method(name(a))" -> (METHOD_PCD name (ARG a))
    "method(name(a)"                            FAIL
    "method(name(int,int,a))" -> (METHOD_PCD name (ARG (PRIMITIVE int)) (ARG (PRIMITIVE int)) (ARG a))
    "method(public   name(int,a))" -> (METHOD_PCD public name (ARG (PRIMITIVE int)) (ARG a))
    "method(static public   name(int,a))" -> (METHOD_PCD static public name (ARG (PRIMITIVE int)) (ARG a))
    "method(static * name(int ,a))" -> (METHOD_PCD static * name (ARG (PRIMITIVE int)) (ARG a))
    "method(static name(int, a))" -> (METHOD_PCD static name (ARG (PRIMITIVE int)) (ARG a))
    "method(static name(Object+ b,*,a))" -> (METHOD_PCD static name (ARG (PATTERN Object (PAT_OPTION MATCH_SUBCLASS)) b) (ARG (PATTERN * PAT_OPTION)) (ARG a))
    "method(name(Object+ b,* c,a))" -> (METHOD_PCD name (ARG (PATTERN Object (PAT_OPTION MATCH_SUBCLASS)) b) (ARG (PATTERN * PAT_OPTION) c) (ARG a))

    // test cases with return type
    "method(void name(int))"                              OK
    "method(java.lang.Object name(int))"                  OK
    "method(static public java.lang.Object name(int))"    OK
    "method(static * java.lang.Object name(int))"         OK
    "method(* java.lang.Object name(int))"                OK
    "method(* java.*lang.Object name(int))"               OK
    "method(* java.lang.Object name(int))"                OK
*/